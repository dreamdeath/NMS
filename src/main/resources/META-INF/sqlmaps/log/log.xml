<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.web.sqlmappers.log.LogMapper">

<insert id="insertLogInfo" parameterType="LogVo">
	INSERT INTO tb_nms_log (server_id, info, log_type) 	
	VALUES(#{server_id},#{info},#{log_type})
</insert>

<select id="getLogList" parameterType="LogVo" resultType="LogVo">
	SELECT a.id, a.server_id, a.info, DATE_FORMAT(a.create_date,'%Y-%m-%d %H:%i:%s') create_date, 
	(
    CASE 
        WHEN a.log_type = 'I' THEN 'INFO'
        ELSE 'ERROR'
    END) AS log_type,
    IFNULL(b.server_name,'그룹') AS server_name
	FROM tb_nms_log a LEFT JOIN tb_server b ON a.server_id = b.id 
	WHERE 1 = 1
	<if test="search_start != '' and search_start != null">
	<![CDATA[
	AND a.CREATE_DATE >= #{search_start}
	]]>
	</if>
	<if test="search_end != '' and search_end != null ">
	<![CDATA[
	AND a.CREATE_DATE <= #{search_end}
	]]>	
	</if>
	<if test="sortdatafield != '' and sortdatafield != null ">
		ORDER BY ${sortdatafield} ${sortorder}
	</if>
	<if test="sortdatafield == '' or sortdatafield == null ">
		ORDER BY CREATE_DATE DESC
	</if>
	
	LIMIT #{recordstartindex} , #{recordendindex} 


</select>
<delete id="deleteServerInfo" parameterType = "ServerVo">
	DELETE FROM TB_NMS_LOG
	<if test="search_start == ''">
	<![CDATA[
	AND create_date >= #{search_start}
	]]>
	</if>
	<if test="search_end == ''">
	<![CDATA[
	AND create_date <= #{search_end}
	]]>
	</if>
</delete>
</mapper>